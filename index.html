<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marketplace Meme Colombiano</title>
<style>
body { font-family: Arial; background:#f2f2f2; text-align:center; margin:0; padding:0; }
.pantalla { display:none; padding:20px; }
button { padding:12px; margin:10px; font-size:18px; cursor:pointer; }
#topCoins { font-size:24px; display:none; margin:10px 0; }
#juegoArea { width:90vw; max-width:400px; height:60vh; background:#222; margin:auto; position:relative; overflow:hidden; }
#player { width:10%; min-width:30px; height:10%; min-height:30px; background:#0f0; position:absolute; bottom:5%; left:45%; }
.cubo { width:10%; min-width:30px; height:10%; min-height:30px; background:red; position:absolute; top:0; }
#objLista div, #invLista div, #histLista div, #chatMensajes div { margin:5px; padding:5px; border:1px solid #000; font-size:16px; }
.botonesMovimiento { margin-top:10px; }
.botonesMovimiento button { width:22vw; max-width:120px; height:12vw; max-height:60px; font-size:22px; margin:5px; }
#chatMensajes { height:200px; overflow-y:auto; border:1px solid #000; padding:5px; background:#fff; margin-bottom:10px; text-align:left; }
input, select { font-size:16px; padding:6px; margin:5px; }
</style>
</head>
<body>

<h2 id="topCoins">CarriCoins: 0</h2>

<div id="login" class="pantalla" style="display:block;">
<h1>Iniciar sesi√≥n / Crear cuenta</h1>
<input id="user" placeholder="Usuario"><br>
<input id="pass" placeholder="Contrase√±a"><br>
<button onclick="crearCuenta()">Crear cuenta</button>
<button onclick="entrar()">Entrar</button>
</div>

<div id="menu" class="pantalla">
<h1>Men√∫ Principal</h1>
<button onclick="mostrar('juego')">Jugar esquivar cubos</button><br>
<button onclick="mostrar('market')">Marketplace</button><br>
<button onclick="mostrar('inventario')">Inventario</button><br>
<button onclick="mostrar('historial')">Historial de ventas</button><br>
<button onclick="mostrar('objLista')">Lista de objetos</button><br>
<button onclick="mostrar('regalo')">Abrir regalo (500 toques)</button><br>
<button onclick="mostrar('ruleta')">Ruleta de objetos</button><br>
<button onclick="mostrar('chatPantalla')">Chat Global / Jugadores</button>
</div>

<div id="juego" class="pantalla">
<h2>Esquivar cubos</h2>
<div id="juegoArea">
<div id="player"></div>
</div>
<p id="score">Puntos: 0</p>
<div class="botonesMovimiento">
<button onclick="mover(-10)">‚¨ÖÔ∏è</button>
<button onclick="mover(10)">‚û°Ô∏è</button>
<button id="pauseBtn">‚èπÔ∏è Pausar/Reanudar</button>
</div>
<button onclick="reiniciarCubos()">üîÑ Reiniciar Cubos</button><br>
<button onclick="volverMenu()">Volver al men√∫</button>
</div>

<div id="market" class="pantalla">
<h2>Marketplace</h2>
<h3>Vender</h3>
<select id="sellItem"></select><br>
<input id="sellPrice" placeholder="Precio en CarriCoins"><br>
<button onclick="ponerEnVenta()">Poner en venta</button>
<h3>Comprar</h3>
<div id="listaVentas"></div>
<button onclick="volverMenu()">Volver</button>
</div>

<div id="inventario" class="pantalla">
<h2>Inventario</h2>
<div id="invLista"></div>
<button onclick="volverMenu()">Volver</button>
</div>

<div id="historial" class="pantalla">
<h2>Historial</h2>
<div id="histLista"></div>
<button onclick="volverMenu()">Volver</button>
</div>

<div id="objLista" class="pantalla">
<h2>Objetos por rareza</h2>
<div id="listaObjetos"></div>
<button onclick="volverMenu()">Volver</button>
</div>

<div id="regalo" class="pantalla">
<h2>Regalo</h2>
<p>Toca 500 veces para recibir un objeto</p>
<p id="toques">Toques: 0 / 500</p>
<button id="tocarRegalo">üéÅ</button>
<button onclick="volverMenu()">Volver</button>
</div>

<div id="ruleta" class="pantalla">
<h2>Ruleta de Objetos</h2>
<p>Tickets disponibles: <span id="ticketCount">0</span></p>
<button onclick="comprarTicket(1)">Comprar 1 Ticket (100 CC)</button>
<button onclick="comprarTicket(10)">Paquete 10 Tickets (900 CC)</button><br>
<button onclick="usarTicket()">Usar Ticket en Ruleta</button><br>
<button onclick="volverMenu()">Volver</button>
</div>

<div id="chatPantalla" class="pantalla">
<h2>Chat Global</h2>
<div id="chatMensajes"></div>
<input id="chatInput" placeholder="Escribe tu mensaje" style="width:70%;">
<button onclick="enviarMensaje()">Enviar</button><br>
<button onclick="volverMenu()">Volver</button>
<h3>Jugadores activos</h3>
<div id="jugadoresActivos"></div>
<h3>Top CarriCoins</h3>
<div id="topDinero"></div>
</div>

<script>
// Base de datos
let db = JSON.parse(localStorage.getItem("db")) || {};
let userActual = localStorage.getItem("userActual") || null;
let puntos = 0;
let cubosActivos = [];
let intervalo = null;
let juegoPausado = false;
let toques = 0;
let ventas = [];
let player = document.getElementById('player');
let chatMensajes = [];

// Objetos
let objetosRangos = [
{nombre:"ü¶ß Goriloco-Banan√≠n",rango:"Com√∫n"},{nombre:"üê∏ PepeSaltarin",rango:"Com√∫n"},{nombre:"üêî PolloNoob",rango:"Com√∫n"},{nombre:"üê¢ TortuSpeed",rango:"Com√∫n"},{nombre:"üêç SnekGamer",rango:"Com√∫n"},
{nombre:"üêÅ Rat√≥nFail",rango:"Com√∫n"},{nombre:"üêô PulpoBrainrot",rango:"Com√∫n"},{nombre:"üê≤ Drag√≥nThug",rango:"Raro"},{nombre:"ü¶ç MonoBruh",rango:"Raro"},{nombre:"ü¶ñ T-RexEpicFail",rango:"Raro"},
{nombre:"ü¶Å Le√≥nMood",rango:"Raro"},{nombre:"ü¶ä ZorroCringe",rango:"Raro"},{nombre:"üêß PenguinoXD",rango:"Raro"},{nombre:"üêµ MonoChad",rango:"Raro"},
{nombre:"üêô PulpoOver9000",rango:"√âpico"},{nombre:"ü¶Ñ Unic√≥rnitoLOL",rango:"√âpico"},{nombre:"üê∫ LoboSus",rango:"√âpico"},{nombre:"üêâ Drag√≥nYeet",rango:"√âpico"},{nombre:"ü¶å RenoBruhMoment",rango:"√âpico"},{nombre:"üê¥ CaballoCringe",rango:"√âpico"},{nombre:"ü¶Ä CrabbyMad",rango:"√âpico"},
{nombre:"üëë ReyCarritoSus",rango:"Legendario"},{nombre:"üêâ DragonCarroYeet",rango:"Legendario"},{nombre:"ü¶Ñ Unic√≥rnitoBruh",rango:"Legendario"},{nombre:"ü¶ñ T-RexChad",rango:"Legendario"},{nombre:"üê≤ Drag√≥nEpicFail",rango:"Legendario"},{nombre:"üêâ F√©nixLOL",rango:"Legendario"},{nombre:"üêâ HydraSus",rango:"Legendario"},
{nombre:"üê≤ Drag√≥nFinalYeet",rango:"UltraLegendario"},{nombre:"üêâ F√©nixCarroLOL",rango:"UltraLegendario"},{nombre:"üêâ HydraUltraBruh",rango:"UltraLegendario"},{nombre:"üëë CarritoSupremoEpic",rango:"UltraLegendario"},{nombre:"ü¶Ñ Unic√≥rnitoOP",rango:"UltraLegendario"},{nombre:"üëπ MemeDios",rango:"Dioses"}];

// Funciones generales
function guardarDB(){localStorage.setItem("db", JSON.stringify(db)); localStorage.setItem("userActual", userActual);}
function mostrar(id){document.querySelectorAll('.pantalla').forEach(p=>p.style.display='none'); document.getElementById(id).style.display='block'; if(id==="objLista") mostrarListaObjetos(); actualizarJugadores();}
function volverMenu(){mostrar('menu');}
function actualizarCoins(){if(userActual) document.getElementById('topCoins').innerText="CarriCoins: "+db[userActual].coins; document.getElementById('topCoins').style.display='block';}

// Crear cuenta con 3 objetos comunes
function crearCuenta(){
  let user=document.getElementById('user').value;
  let pass=document.getElementById('pass').value;
  if(!user||!pass){alert("Usuario y contrase√±a requeridos"); return;}
  if(db[user]){alert("Usuario ya existe"); return;}
  db[user]={pass:pass,coins:50,objetos:[],historial:[],tickets:0};
  let comunes = objetosRangos.filter(o=>o.rango==="Com√∫n");
  for(let i=0;i<3;i++){ db[user].objetos.push(comunes[Math.floor(Math.random()*comunes.length)]); }
  guardarDB();
  alert("Cuenta creada con 3 objetos comunes y 50 CarriCoins");
}

// Entrar
function entrar(){
  let user=document.getElementById('user').value;
  let pass=document.getElementById('pass').value;
  if(!db[user]||db[user].pass!==pass){alert("Usuario o contrase√±a incorrectos"); return;}
  userActual=user; actualizarCoins(); actualizarInventario(); actualizarHistorial(); document.getElementById('ticketCount').innerText=db[userActual].tickets; guardarDB(); mostrar('menu');
}

// Inventario
function actualizarInventario(){
  let inv=document.getElementById('invLista'); inv.innerHTML="";
  db[userActual].objetos.forEach((o,i)=>{let d=document.createElement('div'); d.innerText=o.nombre+" ("+o.rango+")"; inv.appendChild(d);});
  let sell=document.getElementById('sellItem'); sell.innerHTML="";
  db[userActual].objetos.forEach((o,i)=>{let option=document.createElement('option'); option.value=i; option.text=o.nombre+" ("+o.rango+")"; sell.appendChild(option);});
  actualizarMarket(); guardarDB();
}

function ponerEnVenta(){
  let sel=document.getElementById('sellItem'); let index=sel.value;
  let precio=parseInt(document.getElementById('sellPrice').value);
  if(isNaN(precio)||precio<=0){alert("Precio inv√°lido"); return;}
  let obj=db[userActual].objetos.splice(index,1)[0];
  ventas.push({vendedor:userActual,nombre:obj.nombre,precio:precio,objeto:obj});
  actualizarInventario(); actualizarMarket(); alert("Objeto puesto a la venta");
}

function actualizarMarket(){
  let lista=document.getElementById('listaVentas'); lista.innerHTML="";
  ventas.forEach((v,i)=>{
    let d=document.createElement('div');
    d.innerHTML=v.nombre+" ("+v.objeto.rango+") - "+v.precio+" CC "+(v.vendedor!==userActual? "<button onclick='comprar("+i+")'>Comprar</button>":"[Tu objeto]");
    lista.appendChild(d);
  });
}

function comprar(i){
  let v=ventas[i];
  if(db[userActual].coins<v.precio){alert("No tienes suficientes CarriCoins"); return;}
  db[userActual].coins-=v.precio; db[v.vendedor].coins+=v.precio;
  db[userActual].objetos.push(v.objeto);
  db[v.vendedor].historial.push({vendido:v.nombre,precio:v.precio});
  ventas.splice(i,1);
  actualizarCoins(); actualizarInventario(); actualizarMarket(); alert("Compra exitosa");
}

function actualizarHistorial(){
  let h=document.getElementById('histLista'); h.innerHTML="";
  db[userActual].historial.forEach(tr=>{let d=document.createElement('div'); d.innerText="Vendiste "+tr.vendido+" por "+tr.precio+" CC"; h.appendChild(d);});
}

function mostrarListaObjetos(){
  let lista=document.getElementById('listaObjetos'); lista.innerHTML="";
  objetosRangos.forEach(o=>{let d=document.createElement('div'); d.innerText=o.nombre+" ("+o.rango+")"; lista.appendChild(d);});
}

// Movimiento player
function mover(x){let pos=parseFloat(player.style.left)||45; pos+=x; if(pos<0) pos=0; if(pos>80) pos=80; player.style.left=pos+"%";}

// Minijuego y reinicio de cubos
function reiniciarCubos(){ db[userActual].coins += puntos; actualizarCoins(); puntos=0; document.getElementById('score').innerText="Puntos: 0"; cubosActivos.forEach(c=>c.remove()); cubosActivos=[]; clearInterval(intervalo); if(!juegoPausado) iniciarCubos();}
function iniciarCubos(){
  clearInterval(intervalo);
  intervalo=setInterval(()=>{
    if(Math.random()<0.02){
      let cubo=document.createElement('div'); cubo.className="cubo"; cubo.style.left=Math.random()*80+"%"; cubo.style.top="0%";
      document.getElementById('juegoArea').appendChild(cubo); cubosActivos.push(cubo);
    }
    cubosActivos.forEach((c,i)=>{
      let top=parseFloat(c.style.top); c.style.top=(top+0.5)+"%";
      let pL=parseFloat(player.style.left), pR=pL+10, pT=90, pB=100, cL=parseFloat(c.style.left), cR=cL+10, cT=parseFloat(c.style.top), cB=cT+10;
      if(!(pR<cL||pL>cR||pB<cT||pT>cB)){
        db[userActual].coins += puntos; actualizarCoins();
        alert("Te chocaste! Ganaste "+puntos+" CarriCoins");
        reiniciarCubos();
      }
      if(cT>100){c.remove(); cubosActivos.splice(i,1); puntos++; document.getElementById('score').innerText="Puntos: "+puntos;}
    });
  },20);
}

// Bot√≥n pausa/reanuda
document.getElementById('pauseBtn').addEventListener('click', ()=>{
  if(!juegoPausado){ clearInterval(intervalo); juegoPausado=true; alert("Juego pausado ‚èπÔ∏è"); }
  else { iniciarCubos(); juegoPausado=false; alert("Juego reanudado ‚ñ∂Ô∏è"); }
});

// Regalo 500 toques
document.getElementById('tocarRegalo').addEventListener('click',()=>{
  toques++; document.getElementById('toques').innerText=toques+" / 500";
  if(toques>=500){
    let obj=objetosRangos[Math.floor(Math.random()*objetosRangos.length)];
    db[userActual].objetos.push(obj); actualizarInventario();
    alert("¬°Recibiste un objeto del regalo!: "+obj.nombre);
    toques=0; document.getElementById('toques').innerText=toques+" / 500";
  }
});

// Tickets ruleta
function comprarTicket(cant){ let precio=cant==1?100:900; if(db[userActual].coins<precio){alert("No tienes CarriCoins"); return;} db[userActual].coins-=precio; db[userActual].tickets+=cant; document.getElementById('ticketCount').innerText=db[userActual].tickets; actualizarCoins(); guardarDB();}
function usarTicket(){ if(db[userActual].tickets<1){alert("No tienes tickets"); return;} db[userActual].tickets--; document.getElementById('ticketCount').innerText=db[userActual].tickets; let obj=objetosRangos[Math.floor(Math.random()*objetosRangos.length)]; db[userActual].objetos.push(obj); actualizarInventario(); alert("¬°Ganaste en la ruleta!: "+obj.nombre);}

// Chat Global
function enviarMensaje(){
  let msg=document.getElementById('chatInput').value.trim();
  if(msg==="") return;
  chatMensajes.push(userActual+": "+msg);
  document.getElementById('chatInput').value="";
  mostrarChat();
}

function mostrarChat(){
  let chatDiv=document.getElementById('chatMensajes');
  chatDiv.innerHTML="";
  chatMensajes.forEach(m=>{ let d=document.createElement('div'); d.innerText=m; chatDiv.appendChild(d); });
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

// Jugadores activos y top dinero
function actualizarJugadores(){
  let jugadoresDiv=document.getElementById('jugadoresActivos');
  jugadoresDiv.innerHTML="";
  Object.keys(db).forEach(u=>{ let d=document.createElement('div'); d.innerText=u; jugadoresDiv.appendChild(d); });
  let topDiv=document.getElementById('topDinero');
  // Top CarriCoins
  let topJugadores = Object.keys(db).map(u => ({usuario: u, coins: db[u].coins}));
  topJugadores.sort((a,b) => b.coins - a.coins);
  topDiv.innerHTML = "";
  topJugadores.slice(0,10).forEach(t => {
    let d = document.createElement('div');
    d.innerText = t.usuario + ": " + t.coins + " CC";
    topDiv.appendChild(d);
  });
}

// Actualizar cada 3 minutos el chat y jugadores activos
setInterval(() => {
  chatMensajes = []; // Resetea chat cada 3 minutos
  mostrarChat();
  actualizarJugadores();
}, 180000);

// Inicializaci√≥n si ya hay usuario logueado
if(userActual) {
  actualizarCoins();
  actualizarInventario();
  actualizarHistorial();
  document.getElementById('ticketCount').innerText = db[userActual].tickets;
  mostrar('menu');
}
</script>
</body>
</html>
  
