<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Marketplace Game</title>
<style>
  body { font-family: Arial; background:#111; color:white; text-align:center; }
  .seccion { display:none; padding:20px; }
  button{ padding:10px; margin:5px; font-size:16px; }
  #chatBox{ width:90%; height:150px; background:#222; margin:auto; padding:10px; overflow-y:scroll; }
  #jugadoresActivos div, #topGlobal div { background:#222; margin:3px; padding:5px; }
</style>
</head>

<body>

<!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->
<!--       MEN√ö DE INICIO     -->
<!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->
<div id="menuInicio" class="seccion" style="display:block;">
  <h1>Iniciar sesi√≥n / Crear cuenta</h1>

  <input id="userInput" placeholder="Usuario"><br><br>
  <input id="passInput" type="password" placeholder="Contrase√±a"><br><br>

  <button onclick="crearCuenta()">Crear cuenta</button>
  <button onclick="iniciarSesion()">Entrar</button>
</div>

<!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->
<!--     MEN√ö PRINCIPAL     -->
<!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->
<div id="menuPrincipal" class="seccion">
  <h1>Men√∫ Principal</h1>

  <button onclick="mostrar('marketplace')">Marketplace</button><br>
  <button onclick="mostrar('regalo')">Regalo Diario</button><br>
  <button onclick="mostrar('tickets')">Comprar Tickets</button><br>
  <button onclick="mostrar('objLista')">Lista de Objetos</button><br>
  <button onclick="mostrar('juego')">Juego Mini</button><br>
  <button onclick="cerrarSesion()">Cerrar Sesi√≥n</button><br><br>

  <h2>Chat Global</h2>
  <div id="chatBox"></div>
  <input id="chatMensaje" placeholder="Escribe..." style="width:70%;">
  <button onclick="enviarMensaje()">Enviar</button>

  <h2>Jugadores Activos</h2>
  <div id="jugadoresActivos"></div>

  <h2>Top Global</h2>
  <div id="topGlobal"></div>
</div>

<!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->
<!--  OTRAS SECCIONES   -->
<!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->

<div id="marketplace" class="seccion">
  <h2>Marketplace</h2>
  <p>Aqu√≠ ir√° el marketplace real.</p>
  <button onclick="mostrar('menuPrincipal')">Volver</button>
</div>

<div id="regalo" class="seccion">
  <h2>Regalo Diario</h2>
  <button onclick="darRegalo()">Reclamar</button>
  <p id="regaloMsg"></p>
  <button onclick="mostrar('menuPrincipal')">Volver</button>
</div>

<div id="tickets" class="seccion">
  <h2>Tickets</h2>
  <p>Tienes: <span id="ticketsCount">0</span></p>
  <button onclick="comprarTicket()">Comprar Ticket (500 CC)</button>
  <button onclick="mostrar('menuPrincipal')">Volver</button>
</div>

<div id="objLista" class="seccion">
  <h2>Tu Inventario</h2>
  <div id="inventarioBox"></div>
  <button onclick="mostrar('menuPrincipal')">Volver</button>
</div>

<div id="juego" class="seccion">
  <h2>Mini juego</h2>
  <p>Pr√≥ximamente</p>
  <button onclick="mostrar('menuPrincipal')">Volver</button>
</div>

<!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->
<!--        FIREBASE         -->
<!-- ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà -->

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyADVjuoLhcH34XPmZv-sx-eP71rIxVEKEY",
  authDomain: "juego-marketplace.firebaseapp.com",
  projectId: "juego-marketplace",
  storageBucket: "juego-marketplace.firebasestorage.app",
  messagingSenderId: "258620166110",
  appId: "1:258620166110:web:3a101d6f7743b6dbc6574f",
  measurementId: "G-0GZDE8FNEC",
  databaseURL: "https://juego-marketplace-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userActual = null;

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
          SISTEMA DE OBJETOS
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
const objetos = {
  comun: ["üêª","üê∫","üê∂","üê±","üêØ"],
  poco: ["üê®","ü¶Å","üêµ","üôâ","üêÆ"],
  epico: ["ü¶ù","ü¶ä","üê∞","üê≠","üêπ","üêª‚Äç‚ùÑÔ∏è"],
  mitico: ["üóΩ","üóø","üå¨Ô∏è","üåÄ","üå™Ô∏è"],
  legendario: ["ü¶†","ü™±","üêõ","üåä","üåÑ"],
  ultra: ["ü§ñ","üéÉ","üëø","‚õÑ","üë∫","‚ò†Ô∏è"],
  xprn: ["üçÑ","üåµ","üå¥","üå≥","üå≤"],
  toxtor: ["ü¶ï","ü¶ñ","üêä","üêç","ü¶é"],
  gamma: ["ü¶Ñ","üêó","ü¶´","ü¶®","ü¶á","ü¶ú"],
  dioses: ["üê≤","ü¶é","ü¶ö"],
  maestro: ["üïé","üîØ","‚ú°Ô∏è","‚ò¶Ô∏è","‚úùÔ∏è","ü™Ø","‚ò™Ô∏è","‚òØÔ∏è","‚òÆÔ∏è","‚ò∏Ô∏è","üïâÔ∏è","üõê","‚öõÔ∏è"]
};

const probabilidades = {
  comun: 40,
  poco: 20,
  epico: 12,
  mitico: 8,
  legendario: 6,
  ultra: 5,
  xprn: 4,
  toxtor: 3,
  gamma: 1.3,
  dioses: 0.6,
  maestro: 0.1
};

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
          FUNCI√ìN MOSTRAR
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
function mostrar(id){
  document.querySelectorAll(".seccion").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
         SISTEMA DE SESI√ìN
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */

function crearCuenta(){
  let u = userInput.value.trim();
  let p = passInput.value.trim();
  if(!u || !p) return alert("Llene todo");

  db.ref("usuarios/"+u).set({
    pass:p,
    coins:1000,
    tickets:3,
    inventario:[]
  });

  alert("Cuenta creada");
}

function iniciarSesion(){
  let u = userInput.value.trim();
  let p = passInput.value.trim();

  db.ref("usuarios/"+u).once("value", snap=>{
    if(!snap.exists()) return alert("No existe");
    if(snap.val().pass !== p) return alert("Contrase√±a incorrecta");

    userActual = u;
    cargarDatos();
    mostrar("menuPrincipal");
  });
}

function cerrarSesion(){
  userActual=null;
  mostrar("menuInicio");
}

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
            DATOS
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
function cargarDatos(){
  db.ref("usuarios/"+userActual).on("value", snap=>{
    let d=snap.val();
    document.getElementById("ticketsCount").innerText=d.tickets;
    actualizarInventario(d.inventario);
  });
}

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        INVENTARIO
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
function actualizarInventario(inv){
  let box = document.getElementById("inventarioBox");
  box.innerHTML = inv.join(" ");
}

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
            REGALO DIARIO
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
function darRegalo(){
  let obj = generarObjeto();
  db.ref("usuarios/"+userActual+"/inventario").get().then(s=>{
    let arr=s.val()||[];
    arr.push(obj);
    db.ref("usuarios/"+userActual+"/inventario").set(arr);
    regaloMsg.innerText="Ganaste: "+obj;
  });
}

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
      SISTEMA DE PROBABILIDADES
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
function generarObjeto(){
  let total=0;
  for(let r in probabilidades) total+=probabilidades[r];

  let random = Math.random()*total;
  let suma=0;

  for(let r in probabilidades){
    suma+=probabilidades[r];
    if(random <= suma){
      let lista = objetos[r];
      return lista[Math.floor(Math.random()*lista.length)];
    }
  }
}

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
             TICKETS
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
function comprarTicket(){
  db.ref("usuarios/"+userActual).once("value", snap=>{
    let d=snap.val();
    if(d.coins<500) return alert("No tienes coins");

    db.ref("usuarios/"+userActual+"/coins").set(d.coins-500);
    db.ref("usuarios/"+userActual+"/tickets").set(d.tickets+1);
  });
}

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
              CHAT
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
db.ref("chat").on("value", snap=>{
  let box=document.getElementById("chatBox");
  box.innerHTML="";
  snap.forEach(m=>{
    box.innerHTML+=m.val()+"<br>";
  });
});

function enviarMensaje(){
  let msg = userActual+": "+chatMensaje.value;
  db.ref("chat").push(msg);
  chatMensaje.value="";
}

/* ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        JUGADORES ACTIVOS / TOP
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà */
setInterval(()=>{
  db.ref("usuarios").once("value", snap=>{
    let activos=document.getElementById("jugadoresActivos");
    let top=document.getElementById("topGlobal");
    activos.innerHTML="";
    top.innerHTML="";

    let arr=[];

    snap.forEach(u=>{
      let d=u.val();
      activos.innerHTML+=`<div>${u.key}</div>`;
      arr.push({user:u.key,coins:d.coins});
    });

    arr.sort((a,b)=>b.coins-a.coins);
    arr.slice(0,10).forEach(t=>{
      top.innerHTML+=`<div>${t.user}: ${t.coins} CC</div>`;
    });
  });
},3000);
</script>

</body>
</html>
