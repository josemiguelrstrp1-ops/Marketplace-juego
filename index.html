<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>Juego Marketplace</title>

<!-- ðŸ”¥ Estilo especial para CELULAR -->
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0a0f1f, #1c1f3a);
    color: white;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  h2, h3 { margin-top: 20px; }

  input {
    width: 85%;
    max-width: 330px;
    padding: 15px;
    margin: 10px 0;
    border-radius: 12px;
    border: none;
    font-size: 18px;
  }

  button {
    width: 85%;
    max-width: 330px;
    padding: 16px;
    margin: 10px auto;
    font-size: 20px;
    font-weight: bold;
    border: none;
    border-radius: 14px;
    background: #00aaff;
    color: white;
    display: block;
    box-shadow: 0 0 10px #00aaff;
  }

  .backBtn {
    background: #ff4444;
    box-shadow: 0 0 10px #ff4444;
  }

  .menu, .pantalla {
    display: none;
  }

  .visible {
    display: block;
  }

  .footerStats {
    margin-top: 25px;
    padding: 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  .obj {
    font-size: 30px;
    margin: 5px;
  }
</style>
</head>

<body>

<!-- ðŸ”¥ PANTALLA DE INICIO DE SESIÃ“N -->
<div id="inicioSesion" class="pantalla visible">
  <h2>Iniciar sesiÃ³n / Crear cuenta</h2>

  <input id="nombreInput" placeholder="Nombre">
  <input id="passInput" type="password" placeholder="ContraseÃ±a">

  <button onclick="crearCuenta()">Crear Cuenta</button>
  <button onclick="iniciarSesion()">Entrar</button>
</div>


<!-- ðŸ”¥ MENÃš PRINCIPAL -->
<div id="menuPrincipal" class="pantalla">
  <h2>MenÃº Principal</h2>

  <p><b>Carricoins:</b> <span id="coinsLabel">0</span></p>
  <p><b>Tickets:</b> <span id="ticketsLabel">0</span></p>

  <button onclick="abrir('market')">Marketplace</button>
  <button onclick="abrir('regalo')">Regalo Diario</button>
  <button onclick="abrir('inventario')">Inventario</button>
  <button onclick="abrir('chat')">Chat Global</button>
  <button onclick="abrir('top')">Top Global</button>
  <button onclick="abrir('activos')">Jugadores Activos</button>

  <div class="footerStats">
    <h3>ðŸ“Š InformaciÃ³n Global</h3>
    <p>Top Coins, Rarezas, Activos</p>
  </div>
</div>


<!-- ðŸ”¥ MARKETPLACE -->
<div id="market" class="pantalla">
  <h2>Marketplace</h2>
  <p>PrÃ³ximamente...</p>
  <button class="backBtn" onclick="volverMenu()">Volver</button>
</div>

<!-- ðŸ”¥ REGALO DIARIO -->
<div id="regalo" class="pantalla">
  <h2>Regalo Diario</h2>
  <button onclick="darRegalo()">Reclamar</button>
  <p id="regaloResultado"></p>
  <button class="backBtn" onclick="volverMenu()">Volver</button>
</div>

<!-- ðŸ”¥ INVENTARIO -->
<div id="inventario" class="pantalla">
  <h2>Inventario</h2>
  <div id="listaInventario"></div>
  <button class="backBtn" onclick="volverMenu()">Volver</button>
</div>

<!-- ðŸ”¥ CHAT -->
<div id="chat" class="pantalla">
  <h2>Chat Global</h2>
  <div id="chatLog" style="height:200px;overflow-y:scroll;background:#0003;padding:10px;"></div>

  <input id="mensajeInput" placeholder="Mensaje">
  <button onclick="enviarMensaje()">Enviar</button>

  <button class="backBtn" onclick="volverMenu()">Volver</button>
</div>

<!-- ðŸ”¥ TOP -->
<div id="top" class="pantalla">
  <h2>Top Global</h2>
  <p id="topLista"></p>
  <button class="backBtn" onclick="volverMenu()">Volver</button>
</div>

<!-- ðŸ”¥ JUGADORES ACTIVOS -->
<div id="activos" class="pantalla">
  <h2>Jugadores Activos</h2>
  <p id="listaActivos"></p>
  <button class="backBtn" onclick="volverMenu()">Volver</button>
</div>



<!-- +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- ðŸ”¥ FIREBASE SDK IMPORT -->
<!-- +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>

<script>
// CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyADVjuoLhcH34XPmZv-sx-eP71rIxVEKEY",
  authDomain: "juego-marketplace.firebaseapp.com",
  projectId: "juego-marketplace",
  storageBucket: "juego-marketplace.firebasestorage.app",
  messagingSenderId: "258620166110",
  appId: "1:258620166110:web:3a101d6f7743b6dbc6574f",
  measurementId: "G-0GZDE8FNEC",
  databaseURL: "https://juego-marketplace-default-rtdb.firebaseio.com/"
};

// INICIAR FIREBASE
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userActual = null;

// OBJETOS Y RAREZAS
const objetos = {
  comun: ["ðŸ»","ðŸº","ðŸ¶","ðŸ±","ðŸ¯"],
  poco: ["ðŸ¨","ðŸ¦","ðŸµ","ðŸ™‰","ðŸ®"],
  epico: ["ðŸ¦","ðŸ¦Š","ðŸ°","ðŸ­","ðŸ¹","ðŸ»â€â„ï¸"],
  mitico: ["ðŸ—½","ðŸ—¿","ðŸŒ¬ï¸","ðŸŒ€","ðŸŒªï¸"],
  legend: ["ðŸ¦ ","ðŸª±","ðŸ›","ðŸŒŠ","ðŸŒ„"],
  ultra: ["ðŸ¤–","ðŸŽƒ","ðŸ‘¿","â›„","ðŸ‘º","â˜ ï¸"],
  xprn: ["ðŸ„","ðŸŒµ","ðŸŒ´","ðŸŒ³","ðŸŒ²"],
  toxtor: ["ðŸ¦•","ðŸ¦–","ðŸŠ","ðŸ","ðŸ¦Ž"],
  gamma: ["ðŸ¦„","ðŸ—","ðŸ¦«","ðŸ¦¨","ðŸ¦‡","ðŸ¦œ"],
  dioses: ["ðŸ²","ðŸ¦Ž","ðŸ¦š"],
  maestro: ["ðŸ•Ž","ðŸ”¯","âœ¡ï¸","â˜¦ï¸","âœï¸","ðŸª¯","â˜ªï¸","â˜¯ï¸","â˜®ï¸","â˜¸ï¸","ðŸ•‰ï¸","ðŸ›","âš›ï¸"]
};

// PROBABILIDADES POR RAREZA
const prob = {
  comun: 50,
  poco: 20,
  epico: 10,
  mitico: 6,
  legend: 5,
  ultra: 3,
  xprn: 2,
  toxtor: 2,
  gamma: 1,
  dioses: 0.5,
  maestro: 0.5
};


// FUNCIONES DE INTERFAZ
function mostrar(id){
  document.querySelectorAll(".pantalla").forEach(p => p.classList.remove("visible"));
  document.getElementById(id).classList.add("visible");
}

function volverMenu(){
  mostrar("menuPrincipal");
}

function abrir(id){
  mostrar(id);
}


// CREAR CUENTA
function crearCuenta(){
  let user = nombreInput.value;
  let pass = passInput.value;

  if(user.length < 3) return alert("Nombre muy corto");

  db.ref("usuarios/" + user).set({
    pass: pass,
    coins: 50,
    tickets: 3,
    inventario: {}
  });

  alert("Cuenta creada");
}

// INICIAR SESIÃ“N
function iniciarSesion(){
  let user = nombreInput.value;
  let pass = passInput.value;

  db.ref("usuarios/" + user).once("value", snap=>{
    if(!snap.exists()) return alert("No existe");

    let data = snap.val();
    if(data.pass !== pass) return alert("ContraseÃ±a incorrecta");

    userActual = user;
    cargarDatos();
    mostrar("menuPrincipal");
  });
}


// CARGAR DATOS DEL USUARIO
function cargarDatos(){
  db.ref("usuarios/" + userActual).on("value", snap=>{
    let d = snap.val();
    coinsLabel.textContent = d.coins;
    ticketsLabel.textContent = d.tickets;

    // inventario
    let html = "";
    for(let i in d.inventario){
      html += `<span class="obj">${d.inventario[i]}</span>`;
    }
    listaInventario.innerHTML = html;
  });
}


// REGALO DIARIO
function darRegalo(){
  let r = obtenerRandomObjeto();
  
  db.ref("usuarios/" + userActual + "/inventario").push(r);

  regaloResultado.innerHTML = "Ganaste: " + r;
}


// SISTEMA RANDOM DE OBJETOS
function obtenerRandomObjeto(){
  let total = 0;
  for(let r in prob) total += prob[r];

  let rand = Math.random()*total;
  let acum = 0;

  for(let r in prob){
    acum += prob[r];
    if(rand <= acum){
      let arr = objetos[r];
      return arr[Math.floor(Math.random()*arr.length)];
    }
  }
  return objetos.comun[0];
}


// CHAT GLOBAL
function enviarMensaje(){
  let msg = mensajeInput.value;
  if(msg.trim()=="") return;

  db.ref("chat").push({
    user: userActual,
    msg: msg
  });

  mensajeInput.value = "";
}

db.ref("chat").on("child_added", snap=>{
  let d = snap.val();
  chatLog.innerHTML += `<p><b>${d.user}:</b> ${d.msg}</p>`;
});


// TOP GLOBAL
db.ref("usuarios").on("value", snap=>{
  let lista = [];
  snap.forEach(u=>{
    lista.push({nombre: u.key, coins: u.val().coins});
  });

  lista.sort((a,b)=>b.coins - a.coins);

  topLista.innerHTML = lista.slice(0,10).map((e,i)=>
    `<p>${i+1}. ${e.nombre} - ${e.coins}ðŸ’°</p>`
  ).join("");
});


// JUGADORES ACTIVOS
setInterval(()=>{
  db.ref("activos/"+userActual).set(Date.now());
  db.ref("activos/"+userActual).onDisconnect().remove();
}, 5000);

db.ref("activos").on("value", snap=>{
  let html = "";
  snap.forEach(u=>{
    html += `<p>${u.key}</p>`;
  });
  listaActivos.innerHTML = html;
});
</script>

</body>
  </html>
